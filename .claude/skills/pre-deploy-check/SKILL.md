---
name: pre-deploy-check
description: Cloud Runへのデプロイ前に品質チェックを実行。デプロイ、リリース、本番反映、プッシュ前のチェック依頼時に使用。
allowed-tools: Bash, Read
---

# デプロイ前チェック

Cloud Runへのデプロイ前に必要な品質チェックを一括実行し、結果をレポートする。

## チェック項目

以下の順序でチェックを実行する:

### 1. TypeScript型チェック

```bash
npx tsc --noEmit
```

- 型エラーがないことを確認
- エラーがある場合はファイル名と行番号を記録

### 2. Lintチェック

```bash
npm run lint
```

- ESLintエラーがないことを確認
- 警告数があれば記録

### 3. テスト実行

```bash
npm run test:run
```

- 全テストがパスすることを確認
- パス数と失敗数を記録

### 4. ビルド

```bash
npm run build
```

- ビルドが成功することを確認
- エラーがあれば詳細を記録

### 5. Prismaマイグレーション状態

```bash
npx prisma migrate status
```

- 未適用のマイグレーションがないことを確認

### 6. 環境変数確認

以下の必須環境変数が設定されているか `.env` ファイルを確認:

- `DATABASE_URL`: データベース接続URL
- `JWT_SECRET`: JWT署名用シークレット

## 出力フォーマット

チェック完了後、以下のフォーマットで結果を報告:

```markdown
## デプロイ前チェック結果

| チェック項目 | 結果 | 備考 |
|-------------|------|------|
| TypeScript型チェック | OK / NG | エラー内容があれば記載 |
| Lintチェック | OK / NG | 警告数など |
| テスト実行 | OK / NG | パス数/失敗数 |
| ビルド | OK / NG | |
| Prismaマイグレーション | OK / NG | 未適用があれば記載 |
| 環境変数 | OK / NG | 不足があれば記載 |

### 総合判定: [デプロイ可能 / デプロイ不可]

[問題がある場合は詳細と修正方法を記載]
```

## 判定基準

- **デプロイ可能**: 全項目がOK
- **デプロイ不可**: 1つでもNGがある場合

## 注意事項

- ビルドチェックは時間がかかるため、他のチェックの後に実行
- 環境変数はローカル環境での確認であり、本番環境の設定は別途確認が必要
- NGがあった場合は修正方法を提案する
